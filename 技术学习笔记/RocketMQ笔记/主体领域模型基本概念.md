# 主题（Topic）
Apache RocketMQ 中消息传输和存储的顶层容器，用于标识同一类业务逻辑的消息。主题通过TopicName来做唯一标识和区分。
## 定义
主要作用

> [!NOTE] 定义
> - **定义数据的分类隔离**：不同业务最好用不同的主题进行隔离
> - **定义数据的身份和权限**：同一分类的消息使用相同的主题来做身份识别和权限管理。
## 模型关系
![主题的地位](https://rocketmq.apache.org/zh/assets/images/archifortopic-ef512066703a22865613ea9216c4c300.png)

主题是一个逻辑概念，并不是实际的消息容器；
主题有多个队列组成，很多能力最终都是由队列来实现的，例如存储，水平扩展，约束和属性设置。
## 内部属性
### 主题名称
- **定义**：用于标识主题，在集群内全局唯一
- **取值**：由用户自定义
- **约束**：请参见[参数限制](https://rocketmq.apache.org/zh/docs/introduction/03limits)

### 列队列表
- **定义**：是主题的组成单元，实际容器；更多信息，参见[列队（MessageQueue）](https://rocketmq.apache.org/zh/docs/domainModel/03messagequeue)
	- 主要作用
		- 存储顺序性
		- 流式操作语义：可以从位点读取任意数量的消息，可以实现类似聚合读取、回溯读取等特性，RabbitMQ、ActiveMQ等非队列存储模型不具备的。
	- 模型关系
		- 提供消息可靠存储机制，消息会被持久化，配合生产和消费者可实现至少投递一次可靠性语义
	- 内部属性
		- 定义：当前队列是否可以读写数据。
		- 取值：由服务端定义，枚举值如下
			- 6：读写状态，当前队列允许读取消息和写入消息。
			- 4：只读状态，当前队列只允许读取消息，不允许写入消息。
		    - 2：只写状态，当前队列只允许写入消息，不允许读取消息。
		    - 0：不可读写状态，当前队列不允许读取消息和写入消息。
		- 约束：队列的读写权限属于运维侧操作，不建议频繁修改。
	- 版本兼容性
		- 服务端版本升级，可能会出现队列名称无法解析的兼容性问题。
	- 使用建议
		- **按照实际业务消耗设置队列数**
			- 队列数量的设置应遵循少用够用原则，避免随意增加队列数量。
		- 列数过多可能会出现的问题
			- 集群元数据膨胀：
			- 客户端压力过大：队列过多对应更多的轮询请求，增加系统负荷。
		- **常见队列增加场景**
			- 需要增加队列实现物理节点负载均衡
			- 需要增加队列实现顺序消息性能扩展
- **取值**：在创建主题是设置数量
- **约束**：一个主题内至少包含一个队列。

### 消息类型
- 定义：主题所支持的消息类型。
    
- 取值：创建主题时选择消息类型。Apache RocketMQ 支持的主题类型如下：
    
    - Normal：[普通消息](https://rocketmq.apache.org/zh/docs/featureBehavior/01normalmessage)，消息本身无特殊语义，消息之间也没有任何关联。
        
    - FIFO：[顺序消息](https://rocketmq.apache.org/zh/docs/featureBehavior/03fifomessage)，Apache RocketMQ 通过消息分组MessageGroup标记一组特定消息的先后顺序，可以保证消息的投递顺序严格按照消息发送时的顺序。
        
    - Delay：[定时/延时消息](https://rocketmq.apache.org/zh/docs/featureBehavior/02delaymessage)，通过指定延时时间控制消息生产后不要立即投递，而是在延时间隔后才对消费者可见。
        
    - Transaction：[事务消息](https://rocketmq.apache.org/zh/docs/featureBehavior/04transactionmessage)，Apache RocketMQ 支持分布式事务消息，支持应用数据库更新和消息调用的事务一致性保障。
        
- 约束：Apache RocketMQ 从5.0版本开始，支持强制校验消息类型，即每个主题只允许发送一种消息类型的消息，这样可以更好的运维和管理生产系统，避免混乱。为保证向下兼容4.x版本行为，强制校验功能默认开启。
## 行为约束
### **消息类型强制校验**
校验原则如下：

- 消息类型必须一致：发送的消息的类型，必须和目标主题定义的消息类型一致。
    
- 主题类型必须单一：每个主题只支持一种消息类型，不允许将多种类型的消息发送到同一个主题中。
## 使用建议
### **按照业务分类合理拆分主题**
可以从一下角度考虑拆分粒度：
- **消息类型是否一致**：不同类型肯定需要使用不同的主题
    
- **消息业务是否关联**：没有业务交集；男女装订单业务可以用一个主题，但是如果业务量大，就需要更细分拆解。
    
- **消息量级是否一样**：数量级不同或时效性不同的业务消息建议使用不同的主题，例如某些业务消息量很小但是时效性要求很强，如果跟某些万亿级消息量的业务使用同一个主题，会增加消息的等待时长。
### **单一主题只收发一种类型消息，避免混用**
### **主题管理尽量避免自动化机制**
建议在测试环境使用，生产环境切勿使用，避免产生大量垃圾主题，无法管理和回收浪费系统资源。

# 队列
## 定义
实际容器，最小存储单元，主题都是由多个队列组成，以此实现队列数量的水平拆分和队列内部的流式存储。
**主要作用**
- 存储顺序性
    
    队列天然具备顺序性，即消息按照进入队列的顺序写入存储，同一队列间的消息天然存在顺序关系，队列头部为最早写入的消息，队列尾部为最新写入的消息。消息在队列中的位置和消息之间的顺序通过位点（Offset）进行标记管理。
    
- 流式操作语义
    
    Apache RocketMQ 基于队列的存储模型可确保消息从任意位点读取任意数量的消息，以此实现类似聚合读取、回溯读取等特性，这些特性是RabbitMQ、ActiveMQ等非队列存储模型不具备的。
## 模型关系
![队列位置](https://rocketmq.apache.org/zh/assets/images/archiforqueue-dd6788b33bf2fc96b4a1dab83a1b0d71.png)
## 内部属性
读写权限

- 定义：当前队列是否可以读写数据。
    
- 取值：由服务端定义，枚举值如下
    
    - 6：读写状态，当前队列允许读取消息和写入消息。
        
    - 4：只读状态，当前队列只允许读取消息，不允许写入消息。
        
    - 2：只写状态，当前队列只允许写入消息，不允许读取消息。
        
    - 0：不可读写状态，当前队列不允许读取消息和写入消息。
        

- 约束：队列的读写权限属于运维侧操作，不建议频繁修改。
## 版本兼容性
一旦服务端版本升级，可能会出现队列名称无法解析的兼容性问题。
# 消息（Message）
## 定义
最小的传输单元
### 特点
- **消息不可变性**
    
    消息本质上是已经产生并确定的事件，一旦产生后，消息的内容不会发生改变。即使经过传输链路的控制也不会发生变化，消费端获取的消息都是只读消息视图。
    

- **消息持久化**
    
    Apache RocketMQ 会默认对消息进行持久化，即将接收到的消息存储到 Apache RocketMQ 服务端的存储文件中，保证消息的可回溯性和系统故障场景下的可恢复性。
## 模型关系
1. 消息由生产者初始化并发送到Apache RocketMQ 服务端。
    
2. 消息按照到达Apache RocketMQ 服务端的顺序存储到队列中。
    
3. 消费者按照指定的订阅关系从Apache RocketMQ 服务端中获取消息并消费。
## 消息内部属性

**系统保留属性**

**主题名称**

- 定义：当前消息所属的主题的名称。集群内全局唯一。更多信息，请参见[主题（Topic）](https://rocketmq.apache.org/zh/docs/domainModel/02topic)。
    
- 取值：从客户端SDK接口获取。
    
**消息类型**

- 定义：当前消息的类型。
    
- 取值：从客户端SDK接口获取。Apache RocketMQ 支持的消息类型如下：
    
    - Normal：[普通消息](https://rocketmq.apache.org/zh/docs/featureBehavior/01normalmessage)，消息本身无特殊语义，消息之间也没有任何关联。
        
    - FIFO：[顺序消息](https://rocketmq.apache.org/zh/docs/featureBehavior/03fifomessage)，Apache RocketMQ 通过消息分组MessageGroup标记一组特定消息的先后顺序，可以保证消息的投递顺序严格按照消息发送时的顺序。
        
    - Delay：[定时/延时消息](https://rocketmq.apache.org/zh/docs/featureBehavior/02delaymessage)，通过指定延时时间控制消息生产后不要立即投递，而是在延时间隔后才对消费者可见。
        
    - Transaction：[事务消息](https://rocketmq.apache.org/zh/docs/featureBehavior/04transactionmessage)，Apache RocketMQ 支持分布式事务消息，支持应用数据库更新和消息调用的事务一致性保障。
        

**消息队列**

- 定义：实际存储当前消息的队列。更多信息，请参见[队列（MessageQueue）](https://rocketmq.apache.org/zh/docs/domainModel/03messagequeue)。
    
- 取值：由服务端指定并填充。
    

**消息位点**

- 定义：当前消息存储在队列中的位置。更多信息，请参见[消费进度原理](https://rocketmq.apache.org/zh/docs/featureBehavior/09consumerprogress)。
    
- 取值：由服务端指定并填充。取值范围：0~long.Max。
    

**消息ID**

- 定义：消息的唯一标识，集群内每条消息的ID全局唯一。
    
- 取值：生产者客户端系统自动生成。固定为数字和大写字母组成的32位字符串。
    

**索引Key列表（可选）**

- 定义：消息的索引键，可通过设置不同的Key区分消息和快速查找消息。
    
- 取值：由生产者客户端定义。
    

**过滤标签Tag（可选）**

- 定义：消息的过滤标签。消费者可通过Tag对消息进行过滤，仅接收指定标签的消息。
    
- 取值：由生产者客户端定义。
    
- 约束：一条消息仅支持设置一个标签。
    

**定时时间（可选）**

- 定义：定时场景下，消息触发延时投递的毫秒级时间戳。更多信息，请参见[定时/延时消息](https://rocketmq.apache.org/zh/docs/featureBehavior/02delaymessage)。
    
- 取值：由消息生产者定义。
    
- 约束：最大可设置定时时长为40天。
    

**消息发送时间**

- 定义：消息发送时，生产者客户端系统的本地毫秒级时间戳。
    
- 取值：由生产者客户端系统填充。
    
- 说明：客户端系统时钟和服务端系统时钟可能存在偏差，消息发送时间是以客户端系统时钟为准。
    

**消息保存时间戳**

- 定义：消息在Apache RocketMQ 服务端完成存储时，服务端系统的本地毫秒级时间戳。 对于定时消息和事务消息，消息保存时间指的是消息生效对消费方可见的服务端系统时间。

- 取值：由服务端系统填充。
    
- 说明：客户端系统时钟和服务端系统时钟可能存在偏差，消息保留时间是以服务端系统时钟为准。
    

**消费重试次数**

- 定义：消息消费失败后，Apache RocketMQ 服务端重新投递的次数。每次重试后，重试次数加1。更多信息，请参见[消费重试](https://rocketmq.apache.org/zh/docs/featureBehavior/10consumerretrypolicy)。
    
- 取值：由服务端系统标记。首次消费，重试次数为0；消费失败首次重试时，重试次数为1。
    

**业务自定义属性**

- 定义：生产者可以自定义设置的扩展信息。
    
- 取值：由消息生产者自定义，按照字符串键值对设置。
    

**消息负载**

- 定义：业务消息的实际报文数据。
    
- 取值：由生产者负责序列化编码，按照二进制字节传输。
    
- 约束：请参见[参数限制](https://rocketmq.apache.org/zh/docs/introduction/03limits)。
## 行为约束
系统默认的消息最大限制如下：

- 普通和顺序消息：4 MB
    
- 事务和定时或延时消息：64 KB
# 生产者（Producer）
## 定义
是产生消息的客户端实体；
在消息生产者中，可以定义如下传输行为：

- 发送方式：生产者可通过API接口设置消息发送的方式。Apache RocketMQ 支持同步传输和异步传输。
    
- 批量发送：生产者可通过API接口设置消息批量传输的方式。例如，批量发送的消息条数或消息大小。
    
- 事务行为：Apache RocketMQ 支持事务消息，对于事务消息需要生产者配合进行事务检查等行为保障事务的最终一致性。具体信息，请参见[事务消息](https://rocketmq.apache.org/zh/docs/featureBehavior/04transactionmessage)。
生产者和主题的关系为多对多关系
![](https://rocketmq.apache.org/zh/assets/images/producer_topic-f9a6348396228a2976e34a5ad0774314.png)
## 模型关系
生产者的位置和流程如下：
![](https://rocketmq.apache.org/zh/assets/images/archiforproducer-ebb8ff832f6e857cbebc2c17c2044a3b.png)
1. 消息由生产者初始化并发送到Apache RocketMQ 服务端。
    
2. 消息按照到达Apache RocketMQ 服务端的顺序存储到主题的指定队列中。
    
3. 消费者按照指定的订阅关系从Apache RocketMQ 服务端中获取消息并消费。
## 内部属性
### **客户端ID**

- 定义：生产者客户端的标识，用于区分不同的生产者。集群内全局唯一。
    
- 取值：客户端ID由Apache RocketMQ 的SDK自动生成，主要用于日志查看、问题定位等运维场景，不支持修改。
    

### **通信参数**

- 接入点信息 **（必选）** ：连接服务端的接入地址，用于识别服务端集群。 接入点必须按格式配置，建议使用域名，避免使用IP地址，防止节点变更无法进行热点迁移。
- 身份认证信息 **（可选）** ：客户端用于身份验证的凭证信息。 仅在服务端开启身份识别和认证时需要传输。
- 请求超时时间 **（可选）** ：客户端网络请求调用的超时时间。取值范围和默认值，请参见[参数限制](https://rocketmq.apache.org/zh/docs/introduction/03limits)。

### **预绑定主题列表**

- 定义：Apache RocketMQ 的生产者需要将消息发送到的目标主题列表，主要作用如下：
    
    - 事务消息 **（必须设置）** ：事务消息场景下，生产者在故障、重启恢复时，需要检查事务消息的主题中是否有未提交的事务消息。避免生产者发送新消息后，主题中的旧事务消息一直处于未提交状态，造成业务延迟。
        
    - 非事务消息 **（建议设置）** ：服务端会在生产者初始化时根据预绑定主题列表，检查目标主题的访问权限和合法性，而不需要等到应用启动后再检查。
        
        若未设置，或后续消息发送的目标主题动态变更， Apache RocketMQ 会对目标主题进行动态补充检验。
        
- 约束：对于事务消息，预绑定列表必须设置，且需要和事务检查器一起配合使用。
    

**事务检查器**

- 定义：Apache RocketMQ 的事务消息机制中，为保证异常场景下事务的最终一致性，生产者需要主动实现事务检查器的接口。具体信息，请参见[事务消息](https://rocketmq.apache.org/zh/docs/featureBehavior/04transactionmessage)。
    
- 发送事务消息时，事务检查器必须设置，且需要和预绑定主题列表一起配合使用。
    

**发送重试策略**：

- 定义: 生产者在消息发送失败时的重试策略。具体信息，请参见[消息发送重试机制](https://rocketmq.apache.org/zh/docs/featureBehavior/05sendretrypolicy)。

## 使用建议

**不建议单一进程创建大量生产者**

对于生产者的创建和初始化，建议遵循够用即可、最大化复用原则，如果有需要发送消息到多个主题的场景，无需为每个主题都创建一个生产者。

**不建议频繁创建和销毁生产者**

Apache RocketMQ 的生产者是可以重复利用的底层资源，类似数据库的连接池。因此不需要在每次发送消息时动态创建生产者，且在发送结束后销毁生产者。这样频繁的创建销毁会在服务端产生大量短连接请求，严重影响系统性能。

# 消费者分组（ConsumerGroup）
## 定义
承载多个消费行为一致的消费者的负载均衡分组。
是一个逻辑资源。通过消费者分组内初始化多个消费者实现消费性能的水平扩展以及高可用容灾。

在消费者分组中，统一定义以下消费行为，同一分组下的多个消费者将按照分组内统一的消费行为和负载均衡策略消费消息。

- 订阅关系：Apache RocketMQ 以消费者分组的粒度管理订阅关系，实现订阅关系的管理和追溯。具体信息，请参见[订阅关系（Subscription）](https://rocketmq.apache.org/zh/docs/domainModel/09subscription)。
    
- 投递顺序性：Apache RocketMQ 的服务端将消息投递给消费者消费时，支持顺序投递和并发投递，投递方式在消费者分组中统一配置。具体信息，请参见[顺序消息](https://rocketmq.apache.org/zh/docs/featureBehavior/03fifomessage)。
    
- 消费重试策略： 消费者消费消息失败时的重试策略，包括重试次数、死信队列设置等。具体信息，请参见[消费重试](https://rocketmq.apache.org/zh/docs/featureBehavior/10consumerretrypolicy)。
## 模型关系
![](https://rocketmq.apache.org/zh/assets/images/archiforconsumergroup-9d98f4f7fc0302aa2363454a552477d9.png)
1. 消息由生产者初始化并发送到Apache RocketMQ 服务端。
    
2. 消息按照到达Apache RocketMQ 服务端的顺序存储到主题的指定队列中。
    
3. 消费者按照指定的订阅关系从Apache RocketMQ 服务端中获取消息并消费。
## 内部属性
**消费者分组名称**

- 定义：消费者分组的名称，用于区分不同的消费者分组。集群内全局唯一。
- 取值：消费者分组由用户设置并创建。具体命名规范，请参见[参数限制](https://rocketmq.apache.org/zh/docs/introduction/03limits)。

**投递顺序性**

- 定义：消费者消费消息时，Apache RocketMQ 向消费者客户端投递消息的顺序。
    
    根据不同的消费场景，Apache RocketMQ 提供顺序投递和并发投递两种方式。具体信息，请参见[顺序消息](https://rocketmq.apache.org/zh/docs/featureBehavior/03fifomessage)。
    
- 取值：默认投递方式为并发投递。
    

**消费重试策略**

- 定义：消费者消费消息失败时，系统的重试策略。消费者消费消息失败时，系统会按照重试策略，将指定消息投递给消费者重新消费。具体信息，请参见[消费重试](https://rocketmq.apache.org/zh/docs/featureBehavior/10consumerretrypolicy)。
    
- 取值：重试策略包括：
    
    - 最大重试次数：表示消息可以重新被投递的最大次数，超过最大重试次数还没被成功消费，消息将被投递至死信队列或丢弃。
        
    - 重试间隔：Apache RocketMQ 服务端重新投递消息的间隔时间。 最大重试次数和重试间隔的取值范围及默认值，请参见[参数限制](https://rocketmq.apache.org/zh/docs/introduction/03limits)。
        
- 约束：重试间隔仅在PushConsumer消费类型下有效。
    

**订阅关系**

- 定义：当前消费者分组关联的订阅关系集合。包括消费者订阅的主题，以及消息的过滤规则等。订阅关系由消费者动态注册到消费者分组中，Apache RocketMQ 服务端会持久化订阅关系并匹配消息的消费进度。更多信息，请参见[订阅关系（Subscription）](https://rocketmq.apache.org/zh/docs/domainModel/09subscription)。
## 行为约束
Apache RocketMQ 要求同一分组下的所有消费者以下消费行为保持一致：

- **投递顺序**
    
- **消费重试策略**
## 使用建议
**按照业务合理拆分分组**
- 消费者的投递顺序一致
- 消费者业务类型一致：一般消费者分组和主题对应，不同业务域对消息消费的要求不同，例如消息过滤属性、消费重试策略不同。因此，不同业务域主题的消费建议使用不同的消费者分组，避免一个消费者分组消费超过10个主题。
**消费者分组管理尽量避免自动化机制**
但是建议仅在测试环境使用，生产环境请勿打开，避免产生大量消费者分组，无法管理和回收，且浪费系统资源。
# 消费者（Consumer）
## 定义
接收并处理消息的运行实体。消费者通常被集成在业务系统中，从 Apache RocketMQ 服务端获取消息，并将消息转化成业务可理解的信息，供业务逻辑处理。
在消息消费端，可以定义如下传输行为：

- 消费者身份：消费者必须关联一个指定的消费者分组，以获取分组内统一定义的行为配置和消费状态。
    
- 消费者类型：Apache RocketMQ 面向不同的开发场景提供了多样的消费者类型，包括PushConsumer类型、SimpleConsumer类型、PullConsumer类型（仅推荐流处理场景使用）等。具体信息，请参见[消费者分类](https://rocketmq.apache.org/zh/docs/featureBehavior/06consumertype)。
    
- 消费者本地运行配置：消费者根据不同的消费者类型，控制消费者客户端本地的运行配置。例如消费者客户端的线程数，消费并发度等，实现不同的传输效果。
## 模型关系
![](https://rocketmq.apache.org/zh/assets/images/archiforconsumer-24914573add839fdf2ba2cbc0fcab7c4.png)
## 内部属性
**消费者分组名称**

- 定义：当前消费者关联的消费者分组名称，消费者必须关联到指定的消费者分组，通过消费者分组获取消费行为。更多信息，请参见[消费者分组（ConsumerGroup）](https://rocketmq.apache.org/zh/docs/domainModel/07consumergroup)。
    
- 取值：消费者分组为Apache RocketMQ 的逻辑资源，需要您提前通过控制台或OpenAPI创建。具体命名格式，请参见[使用限制](https://rocketmq.apache.org/zh/docs/introduction/03limits)。
    

**客户端ID**

- 定义：消费者客户端的标识，用于区分不同的消费者。集群内全局唯一。
    
- 取值：客户端ID由Apache RocketMQ 的SDK自动生成，主要用于日志查看、问题定位等运维场景，不支持修改。
    

**通信参数**

- 接入点信息 **（必选）** ：连接服务端的接入地址，用于识别服务端集群。 接入点必须按格式配置，建议使用域名，避免使用IP地址，防止节点变更无法进行热点迁移。
- 身份认证信息 **（可选）** ：客户端用于身份验证的凭证信息。 仅在服务端开启身份识别和认证时需要传输。
- 请求超时时间 **（可选）** ：客户端网络请求调用的超时时间。取值范围和默认值，请参见[参数限制](https://rocketmq.apache.org/zh/docs/introduction/03limits)。

**预绑定订阅关系列表**

- 定义：指定消费者的订阅关系列表。 Apache RocketMQ 服务端可在消费者初始化阶段，根据预绑定的订阅关系列表对目标主题进行权限及合法性校验，无需等到应用启动后才能校验。

- 取值：建议在消费者初始化阶段明确订阅关系即要订阅的主题列表，若未设置，或订阅的主题动态变更，Apache RocketMQ 会对目标主题进行动态补充校验。

**消费监听器**

- 定义：Apache RocketMQ 服务端将消息推送给消费者后，消费者调用消息消费逻辑的监听器。
    
- 取值：由消费者客户端本地配置。
    
- 约束：使用PushConsumer类型的消费者消费消息时，消费者客户端必须设置消费监听器。消费者类型的具体信息，请参见[消费者分类](https://rocketmq.apache.org/zh/docs/featureBehavior/06consumertype)。
## 使用建议
**不建议在单一进程内创建大量消费者**

Apache RocketMQ 的消费者在通信协议层面支持非阻塞传输模式，网络通信效率较高，并且支持多线程并发访问。因此，大部分场景下，单一进程内同一个消费分组只需要初始化唯一的一个消费者即可，开发过程中应避免以相同的配置初始化多个消费者。

**不建议频繁创建和销毁消费者**

Apache RocketMQ 的消费者是可以重复利用的底层资源，类似数据库的连接池。因此不需要在每次接收消息时动态创建消费者，且在消费完成后销毁消费者。这样频繁地创建销毁会在服务端产生大量短连接请求，严重影响系统性能。
# 订阅关系（Subscription）
## 定义
消费者获取消息、处理消息的规则和状态配置。
## 订阅关系判断原则
- 不同消费者分组对于同一个主题的订阅相互独立如下图所示，消费者分组Group A和消费者分组Group B分别以不同的订阅关系订阅了同一个主题Topic A，这两个订阅关系互相独立，可以各自定义，不受影响。
    
    ![订阅关系不同分组](https://rocketmq.apache.org/zh/assets/images/subscription_diff_group-0b215b9bb822b4bf43c388e9155ecca1.png)
    
- 同一个消费者分组对于不同主题的订阅也相互独立如下图所示，消费者分组Group A订阅了两个主题Topic A和Topic B，对于Group A中的消费者来说，订阅的Topic A为一个订阅关系，订阅的Topic B为另外一个订阅关系，且这两个订阅关系互相独立，可以各自定义，不受影响。
    
    ![订阅关系相同分组](https://rocketmq.apache.org/zh/assets/images/subscription_one_group-77bd92b987e8264ad3c5f27b29463942.png)
## 模型关系
![订阅关系](https://rocketmq.apache.org/zh/assets/images/archiforsubsciption-a495c04e71ed64b9403b689f9413ed08.png)
## 内部属性
**过滤类型**

- 定义：消息过滤规则的类型。订阅关系中设置消息过滤规则后，系统将按照过滤规则匹配主题中的消息，只将符合条件的消息投递给消费者消费，实现消息的再次分类。
    
- 取值：
    
    - TAG过滤：按照Tag字符串进行全文过滤匹配。
        
    - SQL92过滤：按照SQL语法对消息属性进行过滤匹配。
        

**过滤表达式**

- 定义：自定义的过滤规则表达式。
    
- 取值：具体取值规范，请参见[过滤表达式语法规范](https://rocketmq.apache.org/zh/docs/featureBehavior/07messagefilter)。
## 行为约束
**订阅关系一致**
同一消费者分组内的消费者在消费逻辑上必须保持一致，否则会出现消费冲突，导致部分消息消费异常。
## 使用建议
**建议不要频繁修改订阅关系**

在 Apache RocketMQ 领域模型中，订阅关系关联了过滤规则、消费进度等元数据和相关配置，同时系统需要保证消费者分组下的所有消费者的消费行为、消费逻辑、负载策略等一致，整体运算逻辑比较复杂。因此，不建议在生产环境中通过频繁修改订阅关系来实现业务逻辑的变更，这样可能会导致客户端一直处于负载均衡调整和变更的过程，从而影响消息接收。
